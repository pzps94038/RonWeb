"use strict";(self.webpackChunkRonWeb=self.webpackChunkRonWeb||[]).push([[606],{6606:(J,v,r)=>{r.r(v),r.d(v,{ArticleEditComponent:()=>j});var t=r(4438),m=r(177),l=r(9417),C=r(7587),g=r(19),M=r(8233),f=r(9079),p=r(5964),c=r(6354),d=r(8141),E=r(5558),O=r(7468),I=r(980),h=r(9478),A=r(4366),P=r(9834),D=r(6090),T=r(7343),B=r(2953),x=r(2803),W=r(9813),b=r(5385),L=r(4503),R=r(2007),y=r(5264);function U(i,u){if(1&i){const o=t.RV6();t.qex(0),t.j41(1,"form",2),t.bIt("ngSubmit",function(){t.eBV(o);const s=t.XpG();return t.Njj(s.submit())}),t.j41(2,"div",3),t.nrm(3,"app-input",4),t.k0s(),t.j41(4,"div",3),t.nrm(5,"app-select",5),t.k0s(),t.j41(6,"div",3),t.nrm(7,"app-multiple-select",6),t.k0s(),t.j41(8,"div",3),t.nrm(9,"app-toggle",7),t.k0s(),t.j41(10,"div",3)(11,"app-editor",8),t.bIt("upload",function(s){t.eBV(o);const e=t.XpG();return t.Njj(e.previewUpload(s))}),t.k0s()(),t.j41(12,"div",3)(13,"app-editor",9),t.bIt("upload",function(s){t.eBV(o);const e=t.XpG();return t.Njj(e.contentUpload(s))}),t.k0s()(),t.j41(14,"div",3),t.nrm(15,"app-dynamic-input",10),t.k0s(),t.j41(16,"div",11)(17,"button",12),t.EFF(18," \u4fee\u6539\u6587\u7ae0 "),t.k0s()()(),t.bVm()}if(2&i){const o=t.XpG();t.R7$(),t.Y8G("formGroup",o.form),t.R7$(4),t.Y8G("options",o.categoryOptions()),t.R7$(2),t.Y8G("options",o.labelOptions()),t.R7$(4),t.Y8G("adapter",o.uploadAdapter),t.R7$(2),t.Y8G("adapter",o.uploadAdapter),t.R7$(4),t.AVh("loading",o.editIsLoading()),t.Y8G("disabled",o.editIsLoading())}}function S(i,u){1&i&&t.nrm(0,"app-load-article")}let j=(()=>{var i;class u{constructor(){this.apiSrv=(0,t.WQX)(T.G),this.userSrv=(0,t.WQX)(B.D),this.swalSrv=(0,t.WQX)(h.X),this.articleCategorySrv=(0,t.WQX)(L.c),this.articleLabelSrv=(0,t.WQX)(R.k),this.articleSrv=(0,t.WQX)(x.N),this.uploadAdapterSrv=(0,t.WQX)(y.c),this.route=(0,t.WQX)(A.nX),this.router=(0,t.WQX)(A.Ix),this.location=(0,t.WQX)(m.aZ),this.isLoading=(0,t.vPA)(!1),this.editIsLoading=(0,t.vPA)(!1),this.files=(0,t.vPA)([]),this.categoryOptions=(0,t.vPA)([]),this.labelOptions=(0,t.vPA)([]),this.prevFiles=(0,t.vPA)([]),this.contentFiles=(0,t.vPA)([]),this.uploadAdapter=this.uploadAdapterSrv.createArticleAdapter(),this.form=new l.gE({articleId:new l.MJ(void 0,[l.k0.required]),articleTitle:new l.MJ("",[l.k0.required]),flag:new l.MJ("",[l.k0.required]),previewContent:new l.MJ("",[l.k0.required]),content:new l.MJ("",[l.k0.required]),categoryId:new l.MJ("",[l.k0.required]),labels:new l.MJ([]),references:new l.MJ([])}),this._destroyRef=(0,t.WQX)(t.abz)}ngOnInit(){const a=this.articleCategorySrv.getArticleCategory().pipe((0,p.p)(e=>this.apiSrv.ifSuccess(e)),(0,c.T)(({data:{categorys:e}})=>e),(0,c.T)(e=>e.map(({categoryId:_,categoryName:n})=>({value:_,text:n}))),(0,d.M)(e=>{e=[{text:"\u8acb\u9078\u64c7\u6587\u7ae0\u5206\u985e",value:"",disabled:!0},...e],this.categoryOptions.set(e)})),s=this.articleLabelSrv.getArticleLabel().pipe((0,p.p)(e=>this.apiSrv.ifSuccess(e)),(0,c.T)(({data:{labels:e}})=>e),(0,c.T)(e=>e.map(_=>({value:_.labelId,text:_.labelName}))),(0,d.M)(e=>this.labelOptions.set(e)));this.route.paramMap.pipe((0,d.M)(()=>this.isLoading.set(!0)),(0,p.p)(e=>!!e.get("id")),(0,c.T)(e=>e.get("id")),(0,E.n)(e=>this.articleSrv.getArticleById(parseInt(e))),(0,p.p)(e=>this.apiSrv.ifSuccess(e)),(0,c.T)(({data:e})=>e),(0,d.M)(e=>{const{articleId:_,articleTitle:n,previewContent:K,content:N,categoryId:X,labels:F,flag:V,references:G}=e;this.form.controls.articleId.setValue(_),this.form.controls.articleTitle.setValue(n),this.form.controls.content.setValue(N),this.form.controls.categoryId.setValue(X),this.form.controls.previewContent.setValue(K),this.form.controls.flag.setValue(V);const Q=F.map(({labelId:$})=>$);this.form.controls.labels.setValue(Q),this.form.controls.references.setValue(G)}),(0,E.n)(()=>(0,O.p)([a,s])),(0,f.pQ)(this._destroyRef)).subscribe(()=>this.isLoading.set(!1))}submit(){var a;if(this.form.markAllAsTouched(),this.form.invalid)return;const s=null!==(a=this.form.controls.labels.value)&&void 0!==a?a:[],e=this.labelOptions().filter(n=>s.includes(n.value)).map(n=>({labelId:n.value,labelName:n.text})),_={articleId:this.form.controls.articleId.value,articleTitle:this.form.controls.articleTitle.value,previewContent:this.form.controls.previewContent.value,content:this.form.controls.content.value,categoryId:this.form.controls.categoryId.value,flag:this.form.controls.flag.value,userId:this.userSrv.getUserId(),prevFiles:this.prevFiles(),contentFiles:this.contentFiles(),references:this.form.controls.references.value,labels:e};this.editIsLoading.set(!0),this.articleSrv.updateArticle(_).pipe((0,p.p)(n=>this.apiSrv.ifSuccess(n,!0)),(0,E.n)(({returnMessage:n})=>this.swalSrv.alert({icon:h.J.Success,text:n})),(0,I.j)(()=>this.editIsLoading.set(!1)),(0,f.pQ)(this._destroyRef)).subscribe(()=>this.location.back())}previewUpload(a){this.prevFiles.update(s=>[...s,a])}contentUpload(a){this.contentFiles.update(s=>[...s,a])}}return(i=u).\u0275fac=function(a){return new(a||i)},i.\u0275cmp=t.VBU({type:i,selectors:[["app-article-edit"]],standalone:!0,features:[t.aNF],decls:3,vars:2,consts:[["loading",""],[4,"ngIf","ngIfElse"],[3,"ngSubmit","formGroup"],[1,"my-5"],["labelName","\u6587\u7ae0\u6a19\u984c","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u6587\u7ae0\u6a19\u984c","formControlName","articleTitle",1,"w-full"],["labelName","\u6587\u7ae0\u5206\u985e","labelClass","text-lg my-2 text-center md:text-left","formControlName","categoryId",1,"w-full",3,"options"],["labelName","\u6587\u7ae0\u6a19\u7c64","placeholder","\u8acb\u9078\u64c7\u6587\u7ae0\u6a19\u7c64","labelClass","text-lg my-2 text-center md:text-left","formControlName","labels",1,"w-full",3,"options"],["labelName","\u555f\u7528\u6587\u7ae0","labelClass","text-lg my-2 text-center md:text-left","formControlName","flag"],["labelName","\u9810\u89bd\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u9810\u89bd\u5167\u5bb9","formControlName","previewContent",3,"upload","adapter"],["labelName","\u6587\u7ae0\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","formControlName","content",3,"upload","adapter"],["labelName","\u53c3\u8003\u6587\u7ae0","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u53c3\u8003\u6587\u7ae0","formControlName","references",1,"w-full"],[1,"flex","justify-end","items-center"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(a,s){if(1&a&&t.DNE(0,U,19,8,"ng-container",1)(1,S,1,0,"ng-template",null,0,t.C5r),2&a){const e=t.sdS(2);t.Y8G("ngIf",!s.isLoading())("ngIfElse",e)}},dependencies:[m.MD,m.bT,g.S,C.x,l.X1,l.qT,l.BC,l.cb,l.j4,l.JD,M.w,P.c,D.A,W.a,b.X]}),u})()}}]);