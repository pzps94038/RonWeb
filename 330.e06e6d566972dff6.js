"use strict";(self.webpackChunkRonWeb=self.webpackChunkRonWeb||[]).push([[330],{5330:(Q,h,i)=>{i.r(h),i.d(h,{ArticleEditComponent:()=>W});var t=i(9416),E=i(4755),s=i(9401),M=i(3521),O=i(6355),D=i(166),C=i(5855),d=i(9300),c=i(4004),u=i(8505),m=i(3900),P=i(4128),x=i(8746),T=i(6274),U=i(8884),I=i(9096),A=i(1415),L=i(2436),B=i(1514),b=i(9379),y=i(7929),S=i(4052);function R(n,p){if(1&n){const l=t.EpF();t.ynx(0),t.TgZ(1,"form",2),t.NdJ("ngSubmit",function(){t.CHM(l);const e=t.oxw();return t.KtG(e.submit())}),t.TgZ(2,"div",3),t._UZ(3,"app-input",4),t.qZA(),t.TgZ(4,"div",3),t._UZ(5,"app-select",5),t.qZA(),t.TgZ(6,"div",3),t._UZ(7,"app-multiple-select",6),t.qZA(),t.TgZ(8,"div",3)(9,"app-editor",7),t.NdJ("upload",function(e){t.CHM(l);const a=t.oxw();return t.KtG(a.previewUpload(e))}),t.qZA()(),t.TgZ(10,"div",3)(11,"app-editor",8),t.NdJ("upload",function(e){t.CHM(l);const a=t.oxw();return t.KtG(a.contentUpload(e))}),t.qZA()(),t.TgZ(12,"div",9)(13,"button",10),t._uU(14," \u4fee\u6539\u6587\u7ae0 "),t.qZA()()(),t.BQk()}if(2&n){const l=t.oxw();t.xp6(1),t.Q6J("formGroup",l.form),t.xp6(4),t.Q6J("options",l.categoryOptions()),t.xp6(2),t.Q6J("options",l.labelOptions()),t.xp6(6),t.ekj("loading",l.editIsLoading()),t.Q6J("disabled",l.editIsLoading())}}function K(n,p){1&n&&t._UZ(0,"app-load-article")}let W=(()=>{class n{constructor(){this.apiSrv=(0,t.f3M)(y.s),this.userSrv=(0,t.f3M)(S.K),this.swalSrv=(0,t.f3M)(I.J),this.articleCategorySrv=(0,t.f3M)(T.h),this.articleLabelSrv=(0,t.f3M)(B.F),this.articleSrv=(0,t.f3M)(U.n),this.route=(0,t.f3M)(A.gz),this.router=(0,t.f3M)(A.F0),this.isLoading=(0,t.tdS)(!1),this.editIsLoading=(0,t.tdS)(!1),this.files=(0,t.tdS)([]),this.categoryOptions=(0,t.tdS)([]),this.labelOptions=(0,t.tdS)([]),this.prevFiles=(0,t.tdS)([]),this.contentFiles=(0,t.tdS)([]),this.form=new s.cw({articleId:new s.NI(void 0,[s.kI.required]),articleTitle:new s.NI("",[s.kI.required]),previewContent:new s.NI("",[s.kI.required,s.kI.maxLength(500)]),content:new s.NI("",[s.kI.required]),categoryId:new s.NI("",[s.kI.required]),labels:new s.NI([],[s.kI.required])}),this._destroyRef=(0,t.f3M)(t.ktI)}ngOnInit(){const l=this.articleCategorySrv.getArticleCategory(void 0,!1).pipe((0,d.h)(e=>this.apiSrv.ifSuccess(e)),(0,c.U)(({data:{categorys:e}})=>e),(0,c.U)(e=>e.map(({categoryId:a,categoryName:_})=>({value:a,text:_}))),(0,u.b)(e=>{e=[{text:"\u8acb\u9078\u64c7\u6587\u7ae0\u5206\u985e",value:"",disabled:!0},...e],this.categoryOptions.set(e)})),r=this.articleLabelSrv.getArticleLabel(void 0,!1).pipe((0,d.h)(e=>this.apiSrv.ifSuccess(e)),(0,c.U)(({data:{labels:e}})=>e),(0,c.U)(e=>e.map(a=>({value:a.labelId,text:a.labelName}))),(0,u.b)(e=>this.labelOptions.set(e)));this.route.paramMap.pipe((0,u.b)(()=>this.isLoading.set(!0)),(0,d.h)(e=>!!e.get("id")),(0,c.U)(e=>e.get("id")),(0,m.w)(e=>this.articleSrv.getArticleById(parseInt(e),!1)),(0,d.h)(e=>this.apiSrv.ifSuccess(e)),(0,c.U)(({data:e})=>e),(0,u.b)(e=>{var a,_,o,v,f,g;const{articleId:N,articleTitle:$,previewContent:Z,content:F,categoryId:J,labels:j}=e;null===(a=this.form.get("articleId"))||void 0===a||a.setValue(N),null===(_=this.form.get("articleTitle"))||void 0===_||_.setValue($),null===(o=this.form.get("content"))||void 0===o||o.setValue(F),null===(v=this.form.get("categoryId"))||void 0===v||v.setValue(J),null===(f=this.form.get("previewContent"))||void 0===f||f.setValue(Z);const w=j.map(({labelId:V})=>V);null===(g=this.form.get("labels"))||void 0===g||g.setValue(w)}),(0,m.w)(()=>(0,P.D)([l,r])),(0,C.sL)(this._destroyRef)).subscribe(()=>this.isLoading.set(!1))}submit(){var l,r;if(this.form.markAllAsTouched(),!this.form.valid)return;const e=null!==(l=null===(r=this.form.get("labels"))||void 0===r?void 0:r.value)&&void 0!==l?l:[],a=this.labelOptions().filter(o=>e.includes(o.value)).map(o=>({labelId:o.value,labelName:o.text})),_={articleId:this.form.get("articleId").value,articleTitle:this.form.get("articleTitle").value,previewContent:this.form.get("previewContent").value,content:this.form.get("content").value,categoryId:this.form.get("categoryId").value,userId:this.userSrv.getUserId(),prevFiles:this.prevFiles(),contentFiles:this.contentFiles(),labels:a};this.editIsLoading.set(!0),this.articleSrv.updateArticle(_).pipe((0,d.h)(o=>this.apiSrv.ifSuccess(o,!0)),(0,m.w)(({returnMessage:o})=>this.swalSrv.alert({icon:I.u.Success,text:o})),(0,x.x)(()=>this.editIsLoading.set(!1)),(0,C.sL)(this._destroyRef)).subscribe(()=>{this.router.navigate(["/setting/article"])})}previewUpload(l){this.prevFiles.update(r=>[...r,l])}contentUpload(l){this.contentFiles.update(r=>[...r,l])}}return n.\u0275fac=function(l){return new(l||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-article-edit"]],standalone:!0,features:[t.jDz],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loading",""],[3,"formGroup","ngSubmit"],[1,"my-5"],["labelName","\u6587\u7ae0\u6a19\u984c","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u6587\u7ae0\u6a19\u984c","formControlName","articleTitle",1,"w-full"],["labelName","\u6587\u7ae0\u5206\u985e","labelClass","text-lg my-2 text-center md:text-left","formControlName","categoryId",1,"w-full",3,"options"],["labelName","\u6587\u7ae0\u6a19\u7c64","placeholder","\u8acb\u9078\u64c7\u6587\u7ae0\u6a19\u7c64","labelClass","text-lg my-2 text-center md:text-left","formControlName","labels",1,"w-full",3,"options"],["labelName","\u9810\u89bd\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u9810\u89bd\u5167\u5bb9","formControlName","previewContent",3,"upload"],["labelName","\u6587\u7ae0\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","formControlName","content",3,"upload"],[1,"flex","justify-end","items-center"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(l,r){if(1&l&&(t.YNc(0,R,15,6,"ng-container",0),t.YNc(1,K,1,0,"ng-template",null,1,t.W1O)),2&l){const e=t.MAs(2);t.Q6J("ngIf",!r.isLoading())("ngIfElse",e)}},dependencies:[E.ez,E.O5,O.a,M.P,s.UX,s._Y,s.JJ,s.JL,s.sg,s.u,D.H,L.$,b.M]}),n})()}}]);