"use strict";(self.webpackChunkRonWeb=self.webpackChunkRonWeb||[]).push([[943],{5853:(R,u,e)=>{e.r(u),e.d(u,{ArticleCreateComponent:()=>y});var t=e(2223),p=e(4755),f=e(6355),h=e(5177),s=e(9401),m=e(9096),C=e(6274),g=e(166),c=e(9300),o=e(4004),d=e(8505),A=e(4128),E=e(8746),M=e(3900),v=e(5855),O=e(8884),I=e(5796),D=e(2436),P=e(1514),x=e(2461),T=e(7929),L=e(4052);function U(n,_){if(1&n){const r=t.EpF();t.ynx(0),t.TgZ(1,"form",2),t.NdJ("ngSubmit",function(){t.CHM(r);const a=t.oxw();return t.KtG(a.submit())}),t.TgZ(2,"div",3),t._UZ(3,"app-input",4),t.qZA(),t.TgZ(4,"div",3),t._UZ(5,"app-select",5),t.qZA(),t.TgZ(6,"div",3),t._UZ(7,"app-multiple-select",6),t.qZA(),t.TgZ(8,"div",3),t._UZ(9,"app-editor",7),t.qZA(),t.TgZ(10,"div",3),t._UZ(11,"app-editor",8),t.qZA(),t.TgZ(12,"div",9)(13,"button",10),t._uU(14," \u65b0\u589e\u6587\u7ae0 "),t.qZA()()(),t.BQk()}if(2&n){const r=t.oxw();t.xp6(1),t.Q6J("formGroup",r.form),t.xp6(4),t.Q6J("options",r.categoryOptions()),t.xp6(2),t.Q6J("options",r.labelOptions()),t.xp6(6),t.ekj("loading",r.createIsLoading()),t.Q6J("disabled",r.createIsLoading())}}function B(n,_){1&n&&t._UZ(0,"app-load-article")}let y=(()=>{class n{constructor(){this.apiSrv=(0,t.f3M)(T.s),this.userSrv=(0,t.f3M)(L.K),this.swalSrv=(0,t.f3M)(m.J),this.articleCategorySrv=(0,t.f3M)(C.h),this.articleLabelSrv=(0,t.f3M)(P.F),this.articleSrv=(0,t.f3M)(O.n),this.router=(0,t.f3M)(I.F0),this.isLoading=(0,t.tdS)(!1),this.createIsLoading=(0,t.tdS)(!1),this.categoryOptions=(0,t.tdS)([]),this.labelOptions=(0,t.tdS)([]),this.prevFiles=(0,t.tdS)([]),this.contentFiles=(0,t.tdS)([]),this.form=new s.cw({articleTitle:new s.NI("",[s.kI.required]),previewContent:new s.NI("",[s.kI.required]),labels:new s.NI([],[s.kI.required]),content:new s.NI("",[s.kI.required]),categoryId:new s.NI("",[s.kI.required])}),this._destroyRef=(0,t.f3M)(t.ktI)}ngOnInit(){this.isLoading.set(!0);const r=this.articleCategorySrv.getArticleCategory().pipe((0,c.h)(a=>this.apiSrv.ifSuccess(a)),(0,o.U)(({data:{categorys:a}})=>a),(0,o.U)(a=>a.map(({categoryId:l,categoryName:b})=>({value:l,text:b}))),(0,d.b)(a=>{a=[{text:"\u8acb\u9078\u64c7\u6587\u7ae0\u5206\u985e",value:"",disabled:!0},...a],this.categoryOptions.set(a)})),i=this.articleLabelSrv.getArticleLabel().pipe((0,c.h)(a=>this.apiSrv.ifSuccess(a)),(0,o.U)(({data:{labels:a}})=>a),(0,o.U)(a=>a.map(l=>({value:l.labelId,text:l.labelName}))),(0,d.b)(a=>this.labelOptions.set(a)));(0,A.D)([r,i]).pipe((0,E.x)(()=>this.isLoading.set(!1)),(0,v.sL)(this._destroyRef)).subscribe()}submit(){if(this.form.markAllAsTouched(),!this.form.valid)return;const r=this.form.get("labels")?.value??[],i=this.labelOptions().filter(l=>r.includes(l.value)).map(l=>({labelId:l.value,labelName:l.text})),a={articleTitle:this.form.get("articleTitle").value,previewContent:this.form.get("previewContent").value,content:this.form.get("content").value,categoryId:this.form.get("categoryId").value,userId:this.userSrv.getUserId(),prevFiles:this.prevFiles(),contentFiles:this.contentFiles(),labels:i};this.createIsLoading.set(!0),this.articleSrv.createArticle(a).pipe((0,c.h)(l=>this.apiSrv.ifSuccess(l)),(0,M.w)(({returnMessage:l})=>this.swalSrv.alert({icon:m.u.Success,text:l})),(0,E.x)(()=>this.createIsLoading.set(!1)),(0,v.sL)(this._destroyRef)).subscribe(()=>{this.router.navigate(["/setting/article"])})}previewUpload(r){this.prevFiles.update(i=>[...i,r])}contentUpload(r){this.contentFiles.update(i=>[...i,r])}}return n.\u0275fac=function(r){return new(r||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-article-create"]],standalone:!0,features:[t.jDz],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loading",""],[3,"formGroup","ngSubmit"],[1,"my-5"],["labelName","\u6587\u7ae0\u6a19\u984c","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u6587\u7ae0\u6a19\u984c","formControlName","articleTitle",1,"w-full"],["labelName","\u6587\u7ae0\u5206\u985e","labelClass","text-lg my-2 text-center md:text-left","formControlName","categoryId",1,"w-full",3,"options"],["labelName","\u6587\u7ae0\u6a19\u7c64","placeholder","\u8acb\u9078\u64c7\u6587\u7ae0\u6a19\u7c64","labelClass","text-lg my-2 text-center md:text-left","formControlName","labels",1,"w-full",3,"options"],["labelName","\u9810\u89bd\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u9810\u89bd\u5167\u5bb9","formControlName","previewContent"],["labelName","\u6587\u7ae0\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","formControlName","content"],[1,"flex","justify-end","items-center"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(r,i){if(1&r&&(t.YNc(0,U,15,6,"ng-container",0),t.YNc(1,B,1,0,"ng-template",null,1,t.W1O)),2&r){const a=t.MAs(2);t.Q6J("ngIf",!i.isLoading())("ngIfElse",a)}},dependencies:[p.ez,p.O5,f.a,h.P,s.UX,s._Y,s.JJ,s.JL,s.sg,s.u,g.H,x.M,D.$]}),n})()}}]);