"use strict";(self.webpackChunkRonWeb=self.webpackChunkRonWeb||[]).push([[330],{5330:(Q,f,l)=>{l.r(f),l.d(f,{ArticleEditComponent:()=>K});var t=l(9416),u=l(4755),a=l(9401),g=l(5028),A=l(6355),C=l(166),E=l(5855),c=l(9300),_=l(4004),d=l(8505),m=l(3900),I=l(4128),M=l(8746),h=l(9096),v=l(1415),O=l(2436),D=l(9379),x=l(7929),P=l(4052),T=l(8184),U=l(1781),L=l(2144),B=l(6274),y=l(1514),b=l(231);function S(i,p){if(1&i){const r=t.EpF();t.ynx(0),t.TgZ(1,"form",2),t.NdJ("ngSubmit",function(){t.CHM(r);const e=t.oxw();return t.KtG(e.submit())}),t.TgZ(2,"div",3),t._UZ(3,"app-input",4),t.qZA(),t.TgZ(4,"div",3),t._UZ(5,"app-select",5),t.qZA(),t.TgZ(6,"div",3),t._UZ(7,"app-multiple-select",6),t.qZA(),t.TgZ(8,"div",3),t._UZ(9,"app-toggle",7),t.qZA(),t.TgZ(10,"div",3)(11,"app-editor",8),t.NdJ("upload",function(e){t.CHM(r);const o=t.oxw();return t.KtG(o.previewUpload(e))}),t.qZA()(),t.TgZ(12,"div",3)(13,"app-editor",9),t.NdJ("upload",function(e){t.CHM(r);const o=t.oxw();return t.KtG(o.contentUpload(e))}),t.qZA()(),t.TgZ(14,"div",3),t._UZ(15,"app-dynamic-input",10),t.qZA(),t.TgZ(16,"div",11)(17,"button",12),t._uU(18," \u4fee\u6539\u6587\u7ae0 "),t.qZA()()(),t.BQk()}if(2&i){const r=t.oxw();t.xp6(1),t.Q6J("formGroup",r.form),t.xp6(4),t.Q6J("options",r.categoryOptions()),t.xp6(2),t.Q6J("options",r.labelOptions()),t.xp6(4),t.Q6J("adapter",r.uploadAdapter),t.xp6(2),t.Q6J("adapter",r.uploadAdapter),t.xp6(4),t.ekj("loading",r.editIsLoading()),t.Q6J("disabled",r.editIsLoading())}}function R(i,p){1&i&&t._UZ(0,"app-load-article")}let K=(()=>{class i{constructor(){this.apiSrv=(0,t.f3M)(x.s),this.userSrv=(0,t.f3M)(P.K),this.swalSrv=(0,t.f3M)(h.J),this.articleCategorySrv=(0,t.f3M)(B.h),this.articleLabelSrv=(0,t.f3M)(y.F),this.articleSrv=(0,t.f3M)(T.r),this.uploadAdapterSrv=(0,t.f3M)(b.z),this.route=(0,t.f3M)(v.gz),this.router=(0,t.f3M)(v.F0),this.location=(0,t.f3M)(u.Ye),this.isLoading=(0,t.tdS)(!1),this.editIsLoading=(0,t.tdS)(!1),this.files=(0,t.tdS)([]),this.categoryOptions=(0,t.tdS)([]),this.labelOptions=(0,t.tdS)([]),this.prevFiles=(0,t.tdS)([]),this.contentFiles=(0,t.tdS)([]),this.uploadAdapter=this.uploadAdapterSrv.createArticleAdapter(),this.form=new a.cw({articleId:new a.NI(void 0,[a.kI.required]),articleTitle:new a.NI("",[a.kI.required]),flag:new a.NI("",[a.kI.required]),previewContent:new a.NI("",[a.kI.required]),content:new a.NI("",[a.kI.required]),categoryId:new a.NI("",[a.kI.required]),labels:new a.NI([]),references:new a.NI([])}),this._destroyRef=(0,t.f3M)(t.ktI)}ngOnInit(){const r=this.articleCategorySrv.getArticleCategory().pipe((0,c.h)(e=>this.apiSrv.ifSuccess(e)),(0,_.U)(({data:{categorys:e}})=>e),(0,_.U)(e=>e.map(({categoryId:o,categoryName:n})=>({value:o,text:n}))),(0,d.b)(e=>{e=[{text:"\u8acb\u9078\u64c7\u6587\u7ae0\u5206\u985e",value:"",disabled:!0},...e],this.categoryOptions.set(e)})),s=this.articleLabelSrv.getArticleLabel().pipe((0,c.h)(e=>this.apiSrv.ifSuccess(e)),(0,_.U)(({data:{labels:e}})=>e),(0,_.U)(e=>e.map(o=>({value:o.labelId,text:o.labelName}))),(0,d.b)(e=>this.labelOptions.set(e)));this.route.paramMap.pipe((0,d.b)(()=>this.isLoading.set(!0)),(0,c.h)(e=>!!e.get("id")),(0,_.U)(e=>e.get("id")),(0,m.w)(e=>this.articleSrv.getArticleById(parseInt(e))),(0,c.h)(e=>this.apiSrv.ifSuccess(e)),(0,_.U)(({data:e})=>e),(0,d.b)(e=>{const{articleId:o,articleTitle:n,previewContent:N,content:W,categoryId:Z,labels:F,flag:J,references:j}=e;this.form.controls.articleId.setValue(o),this.form.controls.articleTitle.setValue(n),this.form.controls.content.setValue(W),this.form.controls.categoryId.setValue(Z),this.form.controls.previewContent.setValue(N),this.form.controls.flag.setValue(J);const w=F.map(({labelId:V})=>V);this.form.controls.labels.setValue(w),this.form.controls.references.setValue(j)}),(0,m.w)(()=>(0,I.D)([r,s])),(0,E.sL)(this._destroyRef)).subscribe(()=>this.isLoading.set(!1))}submit(){var r;if(this.form.markAllAsTouched(),this.form.invalid)return;const s=null!==(r=this.form.controls.labels.value)&&void 0!==r?r:[],e=this.labelOptions().filter(n=>s.includes(n.value)).map(n=>({labelId:n.value,labelName:n.text})),o={articleId:this.form.controls.articleId.value,articleTitle:this.form.controls.articleTitle.value,previewContent:this.form.controls.previewContent.value,content:this.form.controls.content.value,categoryId:this.form.controls.categoryId.value,flag:this.form.controls.flag.value,userId:this.userSrv.getUserId(),prevFiles:this.prevFiles(),contentFiles:this.contentFiles(),references:this.form.controls.references.value,labels:e};this.editIsLoading.set(!0),this.articleSrv.updateArticle(o).pipe((0,c.h)(n=>this.apiSrv.ifSuccess(n,!0)),(0,m.w)(({returnMessage:n})=>this.swalSrv.alert({icon:h.u.Success,text:n})),(0,M.x)(()=>this.editIsLoading.set(!1)),(0,E.sL)(this._destroyRef)).subscribe(()=>this.location.back())}previewUpload(r){this.prevFiles.update(s=>[...s,r])}contentUpload(r){this.contentFiles.update(s=>[...s,r])}}return i.\u0275fac=function(r){return new(r||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-article-edit"]],standalone:!0,features:[t.jDz],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loading",""],[3,"formGroup","ngSubmit"],[1,"my-5"],["labelName","\u6587\u7ae0\u6a19\u984c","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u6587\u7ae0\u6a19\u984c","formControlName","articleTitle",1,"w-full"],["labelName","\u6587\u7ae0\u5206\u985e","labelClass","text-lg my-2 text-center md:text-left","formControlName","categoryId",1,"w-full",3,"options"],["labelName","\u6587\u7ae0\u6a19\u7c64","placeholder","\u8acb\u9078\u64c7\u6587\u7ae0\u6a19\u7c64","labelClass","text-lg my-2 text-center md:text-left","formControlName","labels",1,"w-full",3,"options"],["labelName","\u555f\u7528\u6587\u7ae0","labelClass","text-lg my-2 text-center md:text-left","formControlName","flag"],["labelName","\u9810\u89bd\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u9810\u89bd\u5167\u5bb9","formControlName","previewContent",3,"adapter","upload"],["labelName","\u6587\u7ae0\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","formControlName","content",3,"adapter","upload"],["labelName","\u53c3\u8003\u6587\u7ae0","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u53c3\u8003\u6587\u7ae0","formControlName","references",1,"w-full"],[1,"flex","justify-end","items-center"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(r,s){if(1&r&&(t.YNc(0,S,19,8,"ng-container",0),t.YNc(1,R,1,0,"ng-template",null,1,t.W1O)),2&r){const e=t.MAs(2);t.Q6J("ngIf",!s.isLoading())("ngIfElse",e)}},dependencies:[u.ez,u.O5,A.a,g.P,a.UX,a._Y,a.JJ,a.JL,a.sg,a.u,C.H,O.$,D.M,U.n,L.b]}),i})()}}]);