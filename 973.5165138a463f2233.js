"use strict";(self.webpackChunkRonWeb=self.webpackChunkRonWeb||[]).push([[973],{4973:(y,E,e)=>{e.r(E),e.d(E,{SearchComponent:()=>U});var t=e(2223),p=e(4755),h=e(5796),_=e(5855),u=e(9841),M=e(9300),o=e(262),f=e(8746),a=e(8028),g=e(7915),l=e(9908),v=e(4217),C=e(4544),O=e(7929),P=e(8884),D=e(2958);const I=function(n,d){return{categoryId:n,categoryName:d}};function A(n,d){if(1&n){const r=t.EpF();t.TgZ(0,"app-article-card",6),t.NdJ("category",function(s){t.CHM(r);const c=t.oxw(3);return t.KtG(c.navigateCategory(s))})("label",function(s){t.CHM(r);const c=t.oxw(3);return t.KtG(c.navigateLabel(s))})("showMore",function(){const c=t.CHM(r).$implicit,m=t.oxw(3);return t.KtG(m.showMore(c.articleId))}),t.qZA()}if(2&n){const r=d.$implicit,i=t.oxw(3);t.Q6J("title",r.articleTitle)("date",r.createDate)("category",t.WLB(7,I,r.categoryId,r.categoryName))("labels",r.labels)("previewContent",r.previewContent)("highlightKeyword",!0)("keyword",i.keyword())}}function T(n,d){if(1&n&&(t.ynx(0),t.TgZ(1,"div",4)(2,"h3"),t._uU(3),t.qZA()(),t.YNc(4,A,1,10,"app-article-card",5),t.BQk()),2&n){const r=t.oxw(2);t.xp6(3),t.hij("\u4ee5\u4e0b\u662f",r.keyword(),"\u7684\u641c\u5c0b\u7d50\u679c\uff1a"),t.xp6(1),t.Q6J("ngForOf",r.articles())}}function K(n,d){if(1&n&&(t.ynx(0),t.YNc(1,T,5,2,"ng-container",0),t.BQk()),2&n){const r=t.oxw(),i=t.MAs(2);t.xp6(1),t.Q6J("ngIf",!r.isLoading())("ngIfElse",i)}}function B(n,d){1&n&&t._UZ(0,"app-loading-keyword")(1,"app-loading-card")(2,"app-loading-card")(3,"app-loading-card")}function S(n,d){if(1&n){const r=t.EpF();t.TgZ(0,"div",7)(1,"app-error",8),t.NdJ("refresh",function(){t.CHM(r);const s=t.oxw();return t.KtG(s.searchKeyword(s.keyword(),s.page()))}),t.qZA()()}}let U=(()=>{class n{constructor(){this.route=(0,t.f3M)(h.gz),this.router=(0,t.f3M)(h.F0),this.articleSrv=(0,t.f3M)(P.n),this.apiSrv=(0,t.f3M)(O.s),this.codeBlockSrv=(0,t.f3M)(D.n),this.keyword=(0,t.tdS)(""),this.total=(0,t.tdS)(0),this.articles=(0,t.tdS)([]),this.isLoading=(0,t.tdS)(!1),this.isError=(0,t.tdS)(!1),this.page=(0,t.tdS)(1),this._destroyRef=(0,t.f3M)(t.ktI)}ngOnInit(){(0,u.a)([this.route.paramMap,this.route.queryParamMap]).pipe((0,M.h)(([r])=>!!r.get("keyword")||(this.router.navigate(["blog"]),!1)),(0,_.sL)(this._destroyRef)).subscribe(([r,i])=>{const s=r.get("keyword");this.keyword.set(s.trim());const c=i.get("page"),m=c?parseInt(c):1;this.page.set(isNaN(m)?1:m),this.searchKeyword(this.keyword(),this.page())})}searchKeyword(r,i){this.isError.set(!1),this.isLoading.set(!0),this.articleSrv.getArticle(i,r).pipe((0,o.K)(s=>{throw this.isError.set(!0),s}),(0,f.x)(()=>this.isLoading.set(!1)),(0,_.sL)(this._destroyRef)).subscribe(s=>{if(this.apiSrv.ifSuccess(s,!1)){const{data:{total:c,articles:m}}=s;this.total.set(c),this.articles.set(m),this.codeBlockSrv.highlightAllBlock()}else this.isError.set(!0)})}showMore(r){this.router.navigateByUrl(`/blog/article/${r}`)}navigateCategory({categoryId:r}){this.router.navigateByUrl(`/blog/category/${r}`)}navigateLabel({labelId:r}){this.router.navigateByUrl(`/blog/label/${r}`)}paginationChange(r){this.router.navigate(["blog","search",this.keyword()],{queryParams:{page:r}})}}return n.\u0275fac=function(r){return new(r||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-search"]],standalone:!0,features:[t.jDz],decls:6,vars:4,consts:[[4,"ngIf","ngIfElse"],["loading",""],["error",""],[3,"total","currentPage","change"],[1,"p-5","bg-base-100","border","border-base-content/10","text-base-content","rounded-md","mx-0","md:mx-5","mb-5"],[3,"title","date","category","labels","previewContent","highlightKeyword","keyword","label","showMore",4,"ngFor","ngForOf"],[3,"title","date","category","labels","previewContent","highlightKeyword","keyword","label","showMore"],[1,"bg-neutral","text-neutral-content","rounded-md","mx-0","md:mx-5","p-5","mb-5"],[3,"refresh"]],template:function(r,i){if(1&r&&(t.YNc(0,K,2,2,"ng-container",0),t.YNc(1,B,4,0,"ng-template",null,1,t.W1O),t.YNc(3,S,2,0,"ng-template",null,2,t.W1O),t.TgZ(5,"app-pagination",3),t.NdJ("change",function(c){return i.paginationChange(c)}),t.qZA()),2&r){const s=t.MAs(4);t.Q6J("ngIf",!i.isError())("ngIfElse",s),t.xp6(5),t.Q6J("total",i.total())("currentPage",i.page())}},dependencies:[p.ez,p.sg,p.O5,g.Q,l.y,a.q,v.o,C.g]}),n})()},8884:(y,E,e)=>{e.d(E,{n:()=>M});var t=e(4782),p=e(3144),h=e(2223),_=e(2340),u=e(681);let M=(()=>{class o{constructor(){this.http=(0,h.f3M)(p.eN),this.transferSrv=(0,h.f3M)(u.Z),this.articleByIdMap=new Map}getArticle(a,g){let l=new p.LE;return a&&(l=l.append("page",a)),g&&(l=l.append("keyword",g)),this.http.get(`${_.N.baseUrl}/article`,{params:l})}getArticleById(a,g=!0){return this.transferSrv.transfer(`article-${a}`,()=>{if(g&&this.articleByIdMap.has(a))return this.articleByIdMap.get(a);const v=this.http.get(`${_.N.baseUrl}/article/${a}`).pipe((0,t.d)());return this.articleByIdMap.set(a,v),v},g)}createArticle(a){return this.http.post(`${_.N.baseUrl}/article`,a)}updateArticle(a){return this.http.patch(`${_.N.baseUrl}/article/${a.articleId}`,a)}deleteArticle(a){return this.http.delete(`${_.N.baseUrl}/article/${a}`)}updateArticleViews(a){return this.http.patch(`${_.N.baseUrl}/article/updateArticleViews/${a}`,{})}}return o.\u0275fac=function(a){return new(a||o)},o.\u0275prov=h.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},681:(y,E,e)=>{e.d(E,{Z:()=>M});var t=e(2223),p=e(928),h=e(9646),_=e(8505),u=e(4782);let M=(()=>{class o{constructor(){this.transferState=(0,t.f3M)(t.kie),this.deviceSrv=(0,t.f3M)(p.U)}transfer(a,g,l=!0){const v=(0,t.Cb6)(a);if(this.transferState.hasKey(v)&&l){const C=this.transferState.get(v,void 0);return(0,h.of)(C)}return g().pipe((0,_.b)(O=>{this.deviceSrv.isServer&&this.transferState.set(v,O)}),(0,u.d)())}}return o.\u0275fac=function(a){return new(a||o)},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},4782:(y,E,e)=>{e.d(E,{d:()=>h});var t=e(4707),p=e(3099);function h(_,u,M){let o,f=!1;return _&&"object"==typeof _?({bufferSize:o=1/0,windowTime:u=1/0,refCount:f=!1,scheduler:M}=_):o=_??1/0,(0,p.B)({connector:()=>new t.t(o,u,M),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:f})}}}]);