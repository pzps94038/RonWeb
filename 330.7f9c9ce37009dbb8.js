"use strict";(self.webpackChunkRonWeb=self.webpackChunkRonWeb||[]).push([[330],{5330:(F,m,l)=>{l.r(m),l.d(m,{ArticleEditComponent:()=>y});var t=l(2223),E=l(4755),i=l(9401),v=l(5177),C=l(6355),I=l(166),f=l(5855),_=l(9300),o=l(4004),c=l(8505),u=l(3900),A=l(4128),M=l(8746),O=l(6274),D=l(8884),g=l(9096),h=l(5796),P=l(2436),x=l(1514),T=l(2461),U=l(7929),L=l(4052);function B(n,d){if(1&n){const a=t.EpF();t.ynx(0),t.TgZ(1,"form",2),t.NdJ("ngSubmit",function(){t.CHM(a);const e=t.oxw();return t.KtG(e.submit())}),t.TgZ(2,"div",3),t._UZ(3,"app-input",4),t.qZA(),t.TgZ(4,"div",3),t._UZ(5,"app-select",5),t.qZA(),t.TgZ(6,"div",3),t._UZ(7,"app-multiple-select",6),t.qZA(),t.TgZ(8,"div",3)(9,"app-editor",7),t.NdJ("upload",function(e){t.CHM(a);const r=t.oxw();return t.KtG(r.previewUpload(e))}),t.qZA()(),t.TgZ(10,"div",3)(11,"app-editor",8),t.NdJ("upload",function(e){t.CHM(a);const r=t.oxw();return t.KtG(r.contentUpload(e))}),t.qZA()(),t.TgZ(12,"div",9)(13,"button",10),t._uU(14," \u4fee\u6539\u6587\u7ae0 "),t.qZA()()(),t.BQk()}if(2&n){const a=t.oxw();t.xp6(1),t.Q6J("formGroup",a.form),t.xp6(4),t.Q6J("options",a.categoryOptions()),t.xp6(2),t.Q6J("options",a.labelOptions()),t.xp6(6),t.ekj("loading",a.editIsLoading()),t.Q6J("disabled",a.editIsLoading())}}function b(n,d){1&n&&t._UZ(0,"app-load-article")}let y=(()=>{class n{constructor(){this.apiSrv=(0,t.f3M)(U.s),this.userSrv=(0,t.f3M)(L.K),this.swalSrv=(0,t.f3M)(g.J),this.articleCategorySrv=(0,t.f3M)(O.h),this.articleLabelSrv=(0,t.f3M)(x.F),this.articleSrv=(0,t.f3M)(D.n),this.route=(0,t.f3M)(h.gz),this.router=(0,t.f3M)(h.F0),this.isLoading=(0,t.tdS)(!1),this.editIsLoading=(0,t.tdS)(!1),this.files=(0,t.tdS)([]),this.categoryOptions=(0,t.tdS)([]),this.labelOptions=(0,t.tdS)([]),this.prevFiles=(0,t.tdS)([]),this.contentFiles=(0,t.tdS)([]),this.form=new i.cw({articleId:new i.NI(void 0,[i.kI.required]),articleTitle:new i.NI("",[i.kI.required]),previewContent:new i.NI("",[i.kI.required]),content:new i.NI("",[i.kI.required]),categoryId:new i.NI("",[i.kI.required]),labels:new i.NI([],[i.kI.required])}),this._destroyRef=(0,t.f3M)(t.ktI)}ngOnInit(){const a=this.articleCategorySrv.getArticleCategory().pipe((0,_.h)(e=>this.apiSrv.ifSuccess(e)),(0,o.U)(({data:{categorys:e}})=>e),(0,o.U)(e=>e.map(({categoryId:r,categoryName:p})=>({value:r,text:p}))),(0,c.b)(e=>{e=[{text:"\u8acb\u9078\u64c7\u6587\u7ae0\u5206\u985e",value:"",disabled:!0},...e],this.categoryOptions.set(e)})),s=this.articleLabelSrv.getArticleLabel().pipe((0,_.h)(e=>this.apiSrv.ifSuccess(e)),(0,o.U)(({data:{labels:e}})=>e),(0,o.U)(e=>e.map(r=>({value:r.labelId,text:r.labelName}))),(0,c.b)(e=>this.labelOptions.set(e)));this.route.paramMap.pipe((0,c.b)(()=>this.isLoading.set(!0)),(0,_.h)(e=>!!e.get("id")),(0,o.U)(e=>e.get("id")),(0,u.w)(e=>this.articleSrv.getArticleById(parseInt(e))),(0,_.h)(e=>this.apiSrv.ifSuccess(e)),(0,o.U)(({data:e})=>e),(0,c.b)(e=>{const{articleId:r,articleTitle:p,previewContent:S,content:R,categoryId:K,labels:W}=e;this.form.get("articleId")?.setValue(r),this.form.get("articleTitle")?.setValue(p),this.form.get("content")?.setValue(R),this.form.get("categoryId")?.setValue(K),this.form.get("previewContent")?.setValue(S);const N=W.map(({labelId:Z})=>Z);this.form.get("labels")?.setValue(N)}),(0,u.w)(()=>(0,A.D)([a,s])),(0,f.sL)(this._destroyRef)).subscribe(()=>this.isLoading.set(!1))}submit(){if(this.form.markAllAsTouched(),!this.form.valid)return;const a=this.form.get("labels")?.value??[],s=this.labelOptions().filter(r=>a.includes(r.value)).map(r=>({labelId:r.value,labelName:r.text})),e={articleId:this.form.get("articleId").value,articleTitle:this.form.get("articleTitle").value,previewContent:this.form.get("previewContent").value,content:this.form.get("content").value,categoryId:this.form.get("categoryId").value,userId:this.userSrv.getUserId(),prevFiles:this.prevFiles(),contentFiles:this.contentFiles(),labels:s};this.editIsLoading.set(!0),this.articleSrv.updateArticle(e).pipe((0,_.h)(r=>this.apiSrv.ifSuccess(r,!0)),(0,u.w)(({returnMessage:r})=>this.swalSrv.alert({icon:g.u.Success,text:r})),(0,M.x)(()=>this.editIsLoading.set(!1)),(0,f.sL)(this._destroyRef)).subscribe(()=>{this.router.navigate(["/setting/article"])})}previewUpload(a){this.prevFiles.update(s=>[...s,a])}contentUpload(a){this.contentFiles.update(s=>[...s,a])}}return n.\u0275fac=function(a){return new(a||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-article-edit"]],standalone:!0,features:[t.jDz],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loading",""],[3,"formGroup","ngSubmit"],[1,"my-5"],["labelName","\u6587\u7ae0\u6a19\u984c","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u6587\u7ae0\u6a19\u984c","formControlName","articleTitle",1,"w-full"],["labelName","\u6587\u7ae0\u5206\u985e","labelClass","text-lg my-2 text-center md:text-left","formControlName","categoryId",1,"w-full",3,"options"],["labelName","\u6587\u7ae0\u6a19\u7c64","placeholder","\u8acb\u9078\u64c7\u6587\u7ae0\u6a19\u7c64","labelClass","text-lg my-2 text-center md:text-left","formControlName","labels",1,"w-full",3,"options"],["labelName","\u9810\u89bd\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u9810\u89bd\u5167\u5bb9","formControlName","previewContent",3,"upload"],["labelName","\u6587\u7ae0\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","formControlName","content",3,"upload"],[1,"flex","justify-end","items-center"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(a,s){if(1&a&&(t.YNc(0,B,15,6,"ng-container",0),t.YNc(1,b,1,0,"ng-template",null,1,t.W1O)),2&a){const e=t.MAs(2);t.Q6J("ngIf",!s.isLoading())("ngIfElse",e)}},dependencies:[E.ez,E.O5,C.a,v.P,i.UX,i._Y,i.JJ,i.JL,i.sg,i.u,I.H,P.$,T.M]}),n})()}}]);