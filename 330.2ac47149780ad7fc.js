"use strict";(self.webpackChunkRonWeb=self.webpackChunkRonWeb||[]).push([[330],{5330:(k,A,l)=>{l.r(A),l.d(A,{ArticleEditComponent:()=>F});var t=l(9416),p=l(4755),a=l(9401),D=l(3521),x=l(6355),P=l(166),I=l(5855),c=l(9300),d=l(4004),u=l(8505),f=l(3900),T=l(4128),U=l(8746),M=l(9096),O=l(1415),L=l(2436),B=l(9379),b=l(7929),y=l(4052),S=l(8184),N=l(7134),R=l(2608),K=l(1781),W=l(2144);function $(n,m){if(1&n){const i=t.EpF();t.ynx(0),t.TgZ(1,"form",2),t.NdJ("ngSubmit",function(){t.CHM(i);const e=t.oxw();return t.KtG(e.submit())}),t.TgZ(2,"div",3),t._UZ(3,"app-input",4),t.qZA(),t.TgZ(4,"div",3),t._UZ(5,"app-select",5),t.qZA(),t.TgZ(6,"div",3),t._UZ(7,"app-multiple-select",6),t.qZA(),t.TgZ(8,"div",3),t._UZ(9,"app-toggle",7),t.qZA(),t.TgZ(10,"div",3)(11,"app-editor",8),t.NdJ("upload",function(e){t.CHM(i);const o=t.oxw();return t.KtG(o.previewUpload(e))}),t.qZA()(),t.TgZ(12,"div",3)(13,"app-editor",9),t.NdJ("upload",function(e){t.CHM(i);const o=t.oxw();return t.KtG(o.contentUpload(e))}),t.qZA()(),t.TgZ(14,"div",3),t._UZ(15,"app-dynamic-input",10),t.qZA(),t.TgZ(16,"div",11)(17,"button",12),t._uU(18," \u4fee\u6539\u6587\u7ae0 "),t.qZA()()(),t.BQk()}if(2&n){const i=t.oxw();t.xp6(1),t.Q6J("formGroup",i.form),t.xp6(4),t.Q6J("options",i.categoryOptions()),t.xp6(2),t.Q6J("options",i.labelOptions()),t.xp6(10),t.ekj("loading",i.editIsLoading()),t.Q6J("disabled",i.editIsLoading())}}function Z(n,m){1&n&&t._UZ(0,"app-load-article")}let F=(()=>{class n{constructor(){this.apiSrv=(0,t.f3M)(b.s),this.userSrv=(0,t.f3M)(y.K),this.swalSrv=(0,t.f3M)(M.J),this.articleCategorySrv=(0,t.f3M)(R.c),this.articleLabelSrv=(0,t.f3M)(N.j),this.articleSrv=(0,t.f3M)(S.r),this.route=(0,t.f3M)(O.gz),this.router=(0,t.f3M)(O.F0),this.location=(0,t.f3M)(p.Ye),this.isLoading=(0,t.tdS)(!1),this.editIsLoading=(0,t.tdS)(!1),this.files=(0,t.tdS)([]),this.categoryOptions=(0,t.tdS)([]),this.labelOptions=(0,t.tdS)([]),this.prevFiles=(0,t.tdS)([]),this.contentFiles=(0,t.tdS)([]),this.form=new a.cw({articleId:new a.NI(void 0,[a.kI.required]),articleTitle:new a.NI("",[a.kI.required]),flag:new a.NI("",[a.kI.required]),previewContent:new a.NI("",[a.kI.required]),content:new a.NI("",[a.kI.required]),categoryId:new a.NI("",[a.kI.required]),labels:new a.NI([]),references:new a.NI([])}),this._destroyRef=(0,t.f3M)(t.ktI)}ngOnInit(){const i=this.articleCategorySrv.getArticleCategory(void 0).pipe((0,c.h)(e=>this.apiSrv.ifSuccess(e)),(0,d.U)(({data:{categorys:e}})=>e),(0,d.U)(e=>e.map(({categoryId:o,categoryName:_})=>({value:o,text:_}))),(0,u.b)(e=>{e=[{text:"\u8acb\u9078\u64c7\u6587\u7ae0\u5206\u985e",value:"",disabled:!0},...e],this.categoryOptions.set(e)})),r=this.articleLabelSrv.getArticleLabel(void 0).pipe((0,c.h)(e=>this.apiSrv.ifSuccess(e)),(0,d.U)(({data:{labels:e}})=>e),(0,d.U)(e=>e.map(o=>({value:o.labelId,text:o.labelName}))),(0,u.b)(e=>this.labelOptions.set(e)));this.route.paramMap.pipe((0,u.b)(()=>this.isLoading.set(!0)),(0,c.h)(e=>!!e.get("id")),(0,d.U)(e=>e.get("id")),(0,f.w)(e=>this.articleSrv.getArticleById(parseInt(e))),(0,c.h)(e=>this.apiSrv.ifSuccess(e)),(0,d.U)(({data:e})=>e),(0,u.b)(e=>{var o,_,s,g,v,E,h,C;const{articleId:J,articleTitle:j,previewContent:w,content:V,categoryId:Q,labels:G,flag:H,references:Y}=e;null===(o=this.form.get("articleId"))||void 0===o||o.setValue(J),null===(_=this.form.get("articleTitle"))||void 0===_||_.setValue(j),null===(s=this.form.get("content"))||void 0===s||s.setValue(V),null===(g=this.form.get("categoryId"))||void 0===g||g.setValue(Q),null===(v=this.form.get("previewContent"))||void 0===v||v.setValue(w),null===(E=this.form.get("flag"))||void 0===E||E.setValue(H);const z=G.map(({labelId:X})=>X);null===(h=this.form.get("labels"))||void 0===h||h.setValue(z),null===(C=this.form.get("references"))||void 0===C||C.setValue(Y)}),(0,f.w)(()=>(0,T.D)([i,r])),(0,I.sL)(this._destroyRef)).subscribe(()=>this.isLoading.set(!1))}submit(){var i,r;if(this.form.markAllAsTouched(),this.form.invalid)return;const e=null!==(i=null===(r=this.form.get("labels"))||void 0===r?void 0:r.value)&&void 0!==i?i:[],o=this.labelOptions().filter(s=>e.includes(s.value)).map(s=>({labelId:s.value,labelName:s.text})),_={articleId:this.form.get("articleId").value,articleTitle:this.form.get("articleTitle").value,previewContent:this.form.get("previewContent").value,content:this.form.get("content").value,categoryId:this.form.get("categoryId").value,flag:this.form.get("flag").value,userId:this.userSrv.getUserId(),prevFiles:this.prevFiles(),contentFiles:this.contentFiles(),references:this.form.get("references").value,labels:o};this.editIsLoading.set(!0),this.articleSrv.updateArticle(_).pipe((0,c.h)(s=>this.apiSrv.ifSuccess(s,!0)),(0,f.w)(({returnMessage:s})=>this.swalSrv.alert({icon:M.u.Success,text:s})),(0,U.x)(()=>this.editIsLoading.set(!1)),(0,I.sL)(this._destroyRef)).subscribe(()=>this.location.back())}previewUpload(i){this.prevFiles.update(r=>[...r,i])}contentUpload(i){this.contentFiles.update(r=>[...r,i])}}return n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-article-edit"]],standalone:!0,features:[t.jDz],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loading",""],[3,"formGroup","ngSubmit"],[1,"my-5"],["labelName","\u6587\u7ae0\u6a19\u984c","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u6587\u7ae0\u6a19\u984c","formControlName","articleTitle",1,"w-full"],["labelName","\u6587\u7ae0\u5206\u985e","labelClass","text-lg my-2 text-center md:text-left","formControlName","categoryId",1,"w-full",3,"options"],["labelName","\u6587\u7ae0\u6a19\u7c64","placeholder","\u8acb\u9078\u64c7\u6587\u7ae0\u6a19\u7c64","labelClass","text-lg my-2 text-center md:text-left","formControlName","labels",1,"w-full",3,"options"],["labelName","\u555f\u7528\u6587\u7ae0","labelClass","text-lg my-2 text-center md:text-left","formControlName","flag"],["labelName","\u9810\u89bd\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u9810\u89bd\u5167\u5bb9","formControlName","previewContent",3,"upload"],["labelName","\u6587\u7ae0\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","formControlName","content",3,"upload"],["labelName","\u53c3\u8003\u6587\u7ae0","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u53c3\u8003\u6587\u7ae0","formControlName","references",1,"w-full"],[1,"flex","justify-end","items-center"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(i,r){if(1&i&&(t.YNc(0,$,19,6,"ng-container",0),t.YNc(1,Z,1,0,"ng-template",null,1,t.W1O)),2&i){const e=t.MAs(2);t.Q6J("ngIf",!r.isLoading())("ngIfElse",e)}},dependencies:[p.ez,p.O5,x.a,D.P,a.UX,a._Y,a.JJ,a.JL,a.sg,a.u,P.H,L.$,B.M,K.n,W.b]}),n})()}}]);