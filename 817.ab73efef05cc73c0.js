"use strict";(self.webpackChunkRonWeb=self.webpackChunkRonWeb||[]).push([[817],{9817:(Z,x,s)=>{s.r(x),s.d(x,{ProjectExperienceEditComponent:()=>W});var e=s(9416),u=s(4755),r=s(9401),I=s(5028),O=s(6355),C=s(5855),p=s(9300),a=s(4004),_=s(8505),m=s(3900),D=s(4128),j=s(8746),g=s(9096),M=s(1415),T=s(5555),A=s(9379),R=s(7929),U=s(4052),L=s(231),S=s(6737),B=s(2266),P=s(9415);function y(c,d){if(1&c){const o=e.EpF();e.ynx(0),e.TgZ(1,"form",2),e.NdJ("ngSubmit",function(){e.CHM(o);const t=e.oxw();return e.KtG(t.submit())}),e.TgZ(2,"div",3),e._UZ(3,"app-input",4),e.qZA(),e.TgZ(4,"div",3),e._UZ(5,"app-multiple-select",5),e.qZA(),e.TgZ(6,"div",3),e._UZ(7,"app-multiple-select",6),e.qZA(),e.TgZ(8,"div",3)(9,"app-editor",7),e.NdJ("upload",function(t){e.CHM(o);const l=e.oxw();return e.KtG(l.descriptionUpload(t))}),e.qZA()(),e.TgZ(10,"div",3)(11,"app-editor",8),e.NdJ("upload",function(t){e.CHM(o);const l=e.oxw();return e.KtG(l.contributionsUpload(t))}),e.qZA()(),e.TgZ(12,"div",9)(13,"button",10),e._uU(14," \u4fee\u6539\u5c08\u6848\u7d93\u6b77 "),e.qZA()()(),e.BQk()}if(2&c){const o=e.oxw();e.xp6(1),e.Q6J("formGroup",o.form),e.xp6(4),e.Q6J("options",o.projectRoleOptions()),e.xp6(2),e.Q6J("options",o.technologyToolOptions()),e.xp6(2),e.Q6J("adapter",o.uploadAdapter),e.xp6(2),e.Q6J("adapter",o.uploadAdapter),e.xp6(2),e.ekj("loading",o.editIsLoading()),e.Q6J("disabled",o.editIsLoading())}}function K(c,d){1&c&&e._UZ(0,"app-load-project-experience")}let W=(()=>{class c{constructor(){this.apiSrv=(0,e.f3M)(R.s),this.userSrv=(0,e.f3M)(U.K),this.swalSrv=(0,e.f3M)(g.J),this.projectExperienceSrv=(0,e.f3M)(B.n),this.codeSrv=(0,e.f3M)(S.c),this.uploadAdapterSrv=(0,e.f3M)(L.z),this.route=(0,e.f3M)(M.gz),this.router=(0,e.f3M)(M.F0),this.location=(0,e.f3M)(u.Ye),this.isLoading=(0,e.tdS)(!1),this.editIsLoading=(0,e.tdS)(!1),this.files=(0,e.tdS)([]),this.projectRoleOptions=(0,e.tdS)([]),this.technologyToolOptions=(0,e.tdS)([]),this.descriptionFiles=(0,e.tdS)([]),this.contributionsFiles=(0,e.tdS)([]),this.uploadAdapter=this.uploadAdapterSrv.createProjectExperienceAdapter(),this.form=new r.cw({projectExperienceId:new r.NI(void 0,[r.kI.required]),name:new r.NI("",[r.kI.required]),projectRoles:new r.NI([],[r.kI.required]),technologyTools:new r.NI([],[r.kI.required]),description:new r.NI("",[r.kI.required]),contributions:new r.NI("",[r.kI.required])}),this._destroyRef=(0,e.f3M)(e.ktI)}ngOnInit(){const o=this.codeSrv.getAdminCode(P.h.ProjectRole).pipe((0,p.h)(t=>this.apiSrv.ifSuccess(t)),(0,a.U)(({data:{codes:t}})=>t),(0,a.U)(t=>t.map(l=>({value:l.codeId,text:l.codeName}))),(0,_.b)(t=>this.projectRoleOptions.set(t))),i=this.codeSrv.getAdminCode(P.h.TechnologyTool).pipe((0,p.h)(t=>this.apiSrv.ifSuccess(t)),(0,a.U)(({data:{codes:t}})=>t),(0,a.U)(t=>t.map(l=>({value:l.codeId,text:l.codeName}))),(0,_.b)(t=>this.technologyToolOptions.set(t)));this.route.paramMap.pipe((0,_.b)(()=>this.isLoading.set(!0)),(0,p.h)(t=>!!t.get("id")),(0,a.U)(t=>t.get("id")),(0,m.w)(t=>this.projectExperienceSrv.getProjectExperienceById(parseInt(t))),(0,p.h)(t=>this.apiSrv.ifSuccess(t)),(0,a.U)(({data:t})=>t),(0,_.b)(t=>{const{projectExperienceId:l,name:h,projectRoles:E,technologyTools:f,description:n,contributions:b}=t;this.form.controls.projectExperienceId.setValue(l),this.form.controls.name.setValue(h);const N=E.map(({value:v})=>v);this.form.controls.projectRoles.setValue(N);const F=f.map(({value:v})=>v);this.form.controls.technologyTools.setValue(F),this.form.controls.description.setValue(n),this.form.controls.contributions.setValue(b)}),(0,m.w)(()=>(0,D.D)([o,i])),(0,C.sL)(this._destroyRef)).subscribe(()=>this.isLoading.set(!1))}submit(){var o,i;if(this.form.markAllAsTouched(),this.form.invalid)return;const t=null!==(o=this.form.controls.projectRoles.value)&&void 0!==o?o:[],l=this.projectRoleOptions().filter(n=>t.includes(n.value)).map(n=>({text:n.text,value:n.value})),h=null!==(i=this.form.controls.technologyTools.value)&&void 0!==i?i:[],E=this.technologyToolOptions().filter(n=>h.includes(n.value)).map(n=>({text:n.text,value:n.value})),f={projectExperienceId:this.form.controls.projectExperienceId.value,name:this.form.controls.name.value,description:this.form.controls.description.value,contributions:this.form.controls.contributions.value,projectRoles:l,technologyTools:E,descriptionFiles:this.descriptionFiles(),contributionsFiles:this.contributionsFiles(),userId:this.userSrv.getUserId()};this.editIsLoading.set(!0),this.projectExperienceSrv.updateProjectExperience(f).pipe((0,p.h)(n=>this.apiSrv.ifSuccess(n,!0)),(0,m.w)(({returnMessage:n})=>this.swalSrv.alert({icon:g.u.Success,text:n})),(0,j.x)(()=>this.editIsLoading.set(!1)),(0,C.sL)(this._destroyRef)).subscribe(()=>this.location.back())}descriptionUpload(o){this.descriptionFiles.update(i=>[...i,o])}contributionsUpload(o){this.contributionsFiles.update(i=>[...i,o])}}return c.\u0275fac=function(o){return new(o||c)},c.\u0275cmp=e.Xpm({type:c,selectors:[["app-project-experience-edit"]],standalone:!0,features:[e.jDz],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loading",""],[3,"formGroup","ngSubmit"],[1,"my-5"],["labelName","\u5c08\u6848\u540d\u7a31","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u5c08\u6848\u540d\u7a31","formControlName","name",1,"w-full"],["labelName","\u5c08\u6848\u89d2\u8272","placeholder","\u8acb\u9078\u64c7\u5c08\u6848\u89d2\u8272","labelClass","text-lg my-2 text-center md:text-left","formControlName","projectRoles",1,"w-full",3,"options"],["labelName","\u5c08\u6848\u6280\u8853","placeholder","\u8acb\u9078\u64c7\u5c08\u6848\u6280\u8853","labelClass","text-lg my-2 text-center md:text-left","formControlName","technologyTools",1,"w-full",3,"options"],["labelName","\u5c08\u6848\u63cf\u8ff0","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u5c08\u6848\u63cf\u8ff0","formControlName","description",3,"adapter","upload"],["labelName","\u5c08\u6848\u7d93\u6b77","labelClass","text-lg my-2 text-center md:text-left","formControlName","contributions",3,"adapter","upload"],[1,"flex","justify-end","items-center"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(o,i){if(1&o&&(e.YNc(0,y,15,8,"ng-container",0),e.YNc(1,K,1,0,"ng-template",null,1,e.W1O)),2&o){const t=e.MAs(2);e.Q6J("ngIf",!i.isLoading())("ngIfElse",t)}},dependencies:[u.ez,u.O5,O.a,I.P,r.UX,r._Y,r.JJ,r.JL,r.sg,r.u,T.B,A.M]}),c})()}}]);