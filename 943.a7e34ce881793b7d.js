"use strict";(self.webpackChunkRonWeb=self.webpackChunkRonWeb||[]).push([[943],{5853:(U,p,a)=>{a.r(p),a.d(p,{ArticleCreateComponent:()=>T});var e=a(9523),m=a(4755),f=a(6355),E=a(5177),s=a(5030),v=a(3500),h=a(9096),g=a(6274),C=a(166),c=a(9300),o=a(4004),u=a(8746),A=a(3900),d=a(6736),I=a(8884),M=a(5796),O=a(2436),D=a(1514),x=a(2461);function P(l,_){if(1&l){const t=e.EpF();e.ynx(0),e.TgZ(1,"form",2),e.NdJ("ngSubmit",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.submit())}),e.TgZ(2,"div",3),e._UZ(3,"app-input",4),e.qZA(),e.TgZ(4,"div",3),e._UZ(5,"app-select",5),e.qZA(),e.TgZ(6,"div",3),e._UZ(7,"app-multiple-select",6),e.qZA(),e.TgZ(8,"div",3),e._UZ(9,"app-editor",7),e.qZA(),e.TgZ(10,"div",3),e._UZ(11,"app-editor",8),e.qZA(),e.TgZ(12,"div",9)(13,"button",10),e._uU(14," \u65b0\u589e\u6587\u7ae0 "),e.qZA()()(),e.BQk()}if(2&l){const t=e.oxw();e.xp6(1),e.Q6J("formGroup",t.form),e.xp6(4),e.Q6J("options",t.categoryOptions()),e.xp6(2),e.Q6J("options",t.labelOptions()),e.xp6(6),e.ekj("loading",t.createIsLoading()),e.Q6J("disabled",t.createIsLoading())}}function L(l,_){1&l&&e._UZ(0,"app-load-article")}let T=(()=>{class l{constructor(){this.sharedSrv=(0,e.f3M)(v.F),this.swalSrv=(0,e.f3M)(h.J),this.articleCategorySrv=(0,e.f3M)(g.h),this.articleLabelSrv=(0,e.f3M)(D.F),this.articleSrv=(0,e.f3M)(I.n),this.router=(0,e.f3M)(M.F0),this.isLoading=(0,e.tdS)(!1),this.createIsLoading=(0,e.tdS)(!1),this.categoryOptions=(0,e.tdS)([]),this.labelOptions=(0,e.tdS)([]),this.prevFiles=(0,e.tdS)([]),this.contentFiles=(0,e.tdS)([]),this.form=new s.cw({articleTitle:new s.NI("",[s.kI.required]),previewContent:new s.NI("",[s.kI.required]),labels:new s.NI([],[s.kI.required]),content:new s.NI("",[s.kI.required]),categoryId:new s.NI(void 0,[s.kI.required])}),this._destroyRef=(0,e.f3M)(e.ktI)}ngOnInit(){this.isLoading.set(!0),this.articleCategorySrv.getArticleCategory().pipe((0,c.h)(t=>this.sharedSrv.ifSuccess(t)),(0,o.U)(({data:{categorys:t}})=>t),(0,o.U)(t=>t.map(({categoryId:r,categoryName:i})=>({value:r,text:i}))),(0,u.x)(()=>this.isLoading.set(!1)),(0,d.sL)(this._destroyRef)).subscribe(t=>{t=[{text:"\u8acb\u9078\u64c7\u6587\u7ae0\u5206\u985e",value:"",disabled:!0},...t],this.categoryOptions.set(t)}),this.articleLabelSrv.getArticleLabel().pipe((0,c.h)(t=>this.sharedSrv.ifSuccess(t)),(0,o.U)(({data:{labels:t}})=>t),(0,o.U)(t=>t.map(r=>({value:r.labelId,text:r.labelName}))),(0,u.x)(()=>this.isLoading.set(!1)),(0,d.sL)(this._destroyRef)).subscribe(t=>{this.labelOptions.set(t)})}submit(){if(this.form.markAllAsTouched(),!this.form.valid)return;const t=this.form.get("labels")?.value??[],r=this.labelOptions().filter(n=>t.includes(n.value)).map(n=>({labelId:n.value,labelName:n.text})),i={articleTitle:this.form.get("articleTitle").value,previewContent:this.form.get("previewContent").value,content:this.form.get("content").value,categoryId:this.form.get("categoryId").value,userId:this.sharedSrv.getUserId(),prevFiles:this.prevFiles(),contentFiles:this.contentFiles(),labels:r};this.createIsLoading.set(!0),this.articleSrv.createArticle(i).pipe((0,c.h)(n=>this.sharedSrv.ifSuccess(n)),(0,A.w)(({returnMessage:n})=>this.swalSrv.alert({icon:h.u.Success,text:n})),(0,u.x)(()=>this.createIsLoading.set(!1)),(0,d.sL)(this._destroyRef)).subscribe(()=>{this.router.navigate(["/setting/article"])})}previewUpload(t){this.prevFiles.update(r=>[...r,t])}contentUpload(t){this.contentFiles.update(r=>[...r,t])}}return l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=e.Xpm({type:l,selectors:[["app-article-create"]],standalone:!0,features:[e.jDz],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loading",""],[3,"formGroup","ngSubmit"],[1,"my-5"],["labelName","\u6587\u7ae0\u6a19\u984c","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u6587\u7ae0\u6a19\u984c","formControlName","articleTitle",1,"w-full"],["labelName","\u6587\u7ae0\u5206\u985e","labelClass","text-lg my-2 text-center md:text-left","formControlName","categoryId",1,"w-full",3,"options"],["labelName","\u6587\u7ae0\u6a19\u7c64","placeholder","\u8acb\u9078\u64c7\u6587\u7ae0\u6a19\u7c64","labelClass","text-lg my-2 text-center md:text-left","formControlName","labels",1,"w-full",3,"options"],["labelName","\u9810\u89bd\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u9810\u89bd\u5167\u5bb9","formControlName","previewContent"],["labelName","\u6587\u7ae0\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","formControlName","content"],[1,"flex","justify-end","items-center"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(t,r){if(1&t&&(e.YNc(0,P,15,6,"ng-container",0),e.YNc(1,L,1,0,"ng-template",null,1,e.W1O)),2&t){const i=e.MAs(2);e.Q6J("ngIf",!r.isLoading())("ngIfElse",i)}},dependencies:[m.ez,m.O5,f.a,E.P,s.UX,s._Y,s.JJ,s.JL,s.sg,s.u,C.H,x.M,O.$]}),l})()}}]);