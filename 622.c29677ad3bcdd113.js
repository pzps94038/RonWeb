"use strict";(self.webpackChunkRonWeb=self.webpackChunkRonWeb||[]).push([[622],{241:(K,m,t)=>{t.r(m),t.d(m,{ArticleCreateComponent:()=>S});var e=t(4438),u=t(177),A=t(19),h=t(7587),r=t(9417),v=t(9478),g=t(8233),d=t(5964),c=t(6354),E=t(8141),M=t(7468),C=t(980),O=t(5558),f=t(9079),D=t(4366),P=t(9834),I=t(6090),B=t(7343),x=t(2953),T=t(2803),L=t(9813),R=t(5385),W=t(2007),U=t(4503),b=t(5264);function y(s,p){if(1&s){const o=e.RV6();e.qex(0),e.j41(1,"form",2),e.bIt("ngSubmit",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.submit())}),e.j41(2,"div",3),e.nrm(3,"app-input",4),e.k0s(),e.j41(4,"div",3),e.nrm(5,"app-select",5),e.k0s(),e.j41(6,"div",3),e.nrm(7,"app-multiple-select",6),e.k0s(),e.j41(8,"div",3),e.nrm(9,"app-toggle",7),e.k0s(),e.j41(10,"div",3)(11,"app-editor",8),e.bIt("upload",function(n){e.eBV(o);const a=e.XpG();return e.Njj(a.previewUpload(n))}),e.k0s()(),e.j41(12,"div",3)(13,"app-editor",9),e.bIt("upload",function(n){e.eBV(o);const a=e.XpG();return e.Njj(a.contentUpload(n))}),e.k0s()(),e.j41(14,"div",3),e.nrm(15,"app-dynamic-input",10),e.k0s(),e.j41(16,"div",11)(17,"button",12),e.EFF(18," \u65b0\u589e\u6587\u7ae0 "),e.k0s()()(),e.bVm()}if(2&s){const o=e.XpG();e.R7$(),e.Y8G("formGroup",o.form),e.R7$(4),e.Y8G("options",o.categoryOptions()),e.R7$(2),e.Y8G("options",o.labelOptions()),e.R7$(4),e.Y8G("adapter",o.previewContentUploadAdapter),e.R7$(2),e.Y8G("adapter",o.contentUploadAdapter),e.R7$(4),e.AVh("loading",o.createIsLoading()),e.Y8G("disabled",o.createIsLoading())}}function j(s,p){1&s&&e.nrm(0,"app-load-article")}let S=(()=>{var s;class p{constructor(){this.apiSrv=(0,e.WQX)(B.G),this.userSrv=(0,e.WQX)(x.D),this.swalSrv=(0,e.WQX)(v.X),this.articleCategorySrv=(0,e.WQX)(U.c),this.articleLabelSrv=(0,e.WQX)(W.k),this.articleSrv=(0,e.WQX)(T.N),this.uploadAdapterSrv=(0,e.WQX)(b.c),this.router=(0,e.WQX)(D.Ix),this.location=(0,e.WQX)(u.aZ),this.isLoading=(0,e.vPA)(!1),this.createIsLoading=(0,e.vPA)(!1),this.categoryOptions=(0,e.vPA)([]),this.labelOptions=(0,e.vPA)([]),this.prevFiles=(0,e.vPA)([]),this.contentFiles=(0,e.vPA)([]),this.previewContentUploadAdapter=this.uploadAdapterSrv.createArticleAdapter(),this.contentUploadAdapter=this.uploadAdapterSrv.createArticleAdapter(),this.form=new r.gE({articleTitle:new r.MJ("",[r.k0.required]),labels:new r.MJ([],[]),flag:new r.MJ("Y",[r.k0.required]),previewContent:new r.MJ("",[r.k0.required]),content:new r.MJ("",[r.k0.required]),categoryId:new r.MJ("",[r.k0.required]),references:new r.MJ([])}),this._destroyRef=(0,e.WQX)(e.abz)}ngOnInit(){this.isLoading.set(!0);const l=this.articleCategorySrv.getArticleCategory().pipe((0,d.p)(a=>this.apiSrv.ifSuccess(a)),(0,c.T)(({data:{categorys:a}})=>a),(0,c.T)(a=>a.map(({categoryId:_,categoryName:i})=>({value:_,text:i}))),(0,E.M)(a=>{a=[{text:"\u8acb\u9078\u64c7\u6587\u7ae0\u5206\u985e",value:"",disabled:!0},...a],this.categoryOptions.set(a)})),n=this.articleLabelSrv.getArticleLabel().pipe((0,d.p)(a=>this.apiSrv.ifSuccess(a)),(0,c.T)(({data:{labels:a}})=>a),(0,c.T)(a=>a.map(_=>({value:_.labelId,text:_.labelName}))),(0,E.M)(a=>this.labelOptions.set(a)));(0,M.p)([l,n]).pipe((0,C.j)(()=>this.isLoading.set(!1)),(0,f.pQ)(this._destroyRef)).subscribe()}submit(){var l;if(this.form.markAllAsTouched(),this.form.invalid)return;const n=null!==(l=this.form.controls.labels.value)&&void 0!==l?l:[],a=this.labelOptions().filter(i=>n.includes(i.value)).map(i=>({labelId:i.value,labelName:i.text})),_={articleTitle:this.form.controls.articleTitle.value,previewContent:this.form.controls.previewContent.value,content:this.form.controls.content.value,categoryId:this.form.controls.categoryId.value,flag:this.form.controls.flag.value,userId:this.userSrv.getUserId(),prevFiles:this.prevFiles(),contentFiles:this.contentFiles(),labels:a,references:this.form.controls.references.value};this.createIsLoading.set(!0),this.articleSrv.createArticle(_).pipe((0,d.p)(i=>this.apiSrv.ifSuccess(i)),(0,O.n)(({returnMessage:i})=>this.swalSrv.alert({icon:v.J.Success,text:i})),(0,C.j)(()=>this.createIsLoading.set(!1)),(0,f.pQ)(this._destroyRef)).subscribe(()=>this.location.back())}previewUpload(l){this.prevFiles.update(n=>[...n,l])}contentUpload(l){this.contentFiles.update(n=>[...n,l])}}return(s=p).\u0275fac=function(l){return new(l||s)},s.\u0275cmp=e.VBU({type:s,selectors:[["app-article-create"]],standalone:!0,features:[e.aNF],decls:3,vars:2,consts:[["loading",""],[4,"ngIf","ngIfElse"],[3,"ngSubmit","formGroup"],[1,"my-5"],["labelName","\u6587\u7ae0\u6a19\u984c","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u6587\u7ae0\u6a19\u984c","formControlName","articleTitle",1,"w-full"],["labelName","\u6587\u7ae0\u5206\u985e","labelClass","text-lg my-2 text-center md:text-left","formControlName","categoryId",1,"w-full",3,"options"],["labelName","\u6587\u7ae0\u6a19\u7c64","placeholder","\u8acb\u9078\u64c7\u6587\u7ae0\u6a19\u7c64","labelClass","text-lg my-2 text-center md:text-left","formControlName","labels",1,"w-full",3,"options"],["labelName","\u555f\u7528\u6587\u7ae0","labelClass","text-lg my-2 text-center md:text-left","formControlName","flag"],["labelName","\u9810\u89bd\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u9810\u89bd\u5167\u5bb9","formControlName","previewContent",3,"upload","adapter"],["labelName","\u6587\u7ae0\u5167\u5bb9","labelClass","text-lg my-2 text-center md:text-left","formControlName","content",3,"upload","adapter"],["labelName","\u53c3\u8003\u6587\u7ae0","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u53c3\u8003\u6587\u7ae0","formControlName","references",1,"w-full"],[1,"flex","justify-end","items-center"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(l,n){if(1&l&&e.DNE(0,y,19,8,"ng-container",1)(1,j,1,0,"ng-template",null,0,e.C5r),2&l){const a=e.sdS(2);e.Y8G("ngIf",!n.isLoading())("ngIfElse",a)}},dependencies:[u.MD,u.bT,A.S,h.x,r.X1,r.qT,r.BC,r.cb,r.j4,r.JD,g.w,I.A,P.c,L.a,R.X]}),p})()}}]);