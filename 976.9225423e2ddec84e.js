"use strict";(self.webpackChunkRonWeb=self.webpackChunkRonWeb||[]).push([[976],{8976:(V,x,o)=>{o.r(x),o.d(x,{ProjectExperienceEditComponent:()=>K});var e=o(4438),m=o(177),r=o(9417),D=o(7587),O=o(19),P=o(9079),d=o(5964),p=o(6354),_=o(8141),E=o(5558),T=o(7468),A=o(980),j=o(9478),g=o(4366),R=o(4444),I=o(6090),B=o(7343),W=o(2953),U=o(5264),L=o(2539),y=o(7653),M=o(7113);function b(c,u){if(1&c){const l=e.RV6();e.qex(0),e.j41(1,"form",2),e.bIt("ngSubmit",function(){e.eBV(l);const s=e.XpG();return e.Njj(s.submit())}),e.j41(2,"div",3),e.nrm(3,"app-input",4),e.k0s(),e.j41(4,"div",3),e.nrm(5,"app-multiple-select",5),e.k0s(),e.j41(6,"div",3),e.nrm(7,"app-multiple-select",6),e.k0s(),e.j41(8,"div",3)(9,"app-editor",7),e.bIt("upload",function(s){e.eBV(l);const t=e.XpG();return e.Njj(t.contributionsUpload(s))}),e.k0s()(),e.j41(10,"div",3)(11,"app-editor",8),e.bIt("upload",function(s){e.eBV(l);const t=e.XpG();return e.Njj(t.descriptionUpload(s))}),e.k0s()(),e.j41(12,"div",9)(13,"button",10),e.EFF(14," \u4fee\u6539\u5c08\u6848\u7d93\u6b77 "),e.k0s()()(),e.bVm()}if(2&c){const l=e.XpG();e.R7$(),e.Y8G("formGroup",l.form),e.R7$(4),e.Y8G("options",l.projectRoleOptions()),e.R7$(2),e.Y8G("options",l.technologyToolOptions()),e.R7$(2),e.Y8G("adapter",l.contributionsUploadAdapter),e.R7$(2),e.Y8G("adapter",l.descriptionUploadAdapter),e.R7$(2),e.AVh("loading",l.editIsLoading()),e.Y8G("disabled",l.editIsLoading())}}function S(c,u){1&c&&e.nrm(0,"app-load-project-experience")}let K=(()=>{var c;class u{constructor(){this.apiSrv=(0,e.WQX)(B.G),this.userSrv=(0,e.WQX)(W.D),this.swalSrv=(0,e.WQX)(j.X),this.projectExperienceSrv=(0,e.WQX)(y.M),this.codeSrv=(0,e.WQX)(L._),this.uploadAdapterSrv=(0,e.WQX)(U.c),this.route=(0,e.WQX)(g.nX),this.router=(0,e.WQX)(g.Ix),this.location=(0,e.WQX)(m.aZ),this.isLoading=(0,e.vPA)(!1),this.editIsLoading=(0,e.vPA)(!1),this.files=(0,e.vPA)([]),this.projectRoleOptions=(0,e.vPA)([]),this.technologyToolOptions=(0,e.vPA)([]),this.descriptionFiles=(0,e.vPA)([]),this.contributionsFiles=(0,e.vPA)([]),this.descriptionUploadAdapter=this.uploadAdapterSrv.createProjectExperienceAdapter(),this.contributionsUploadAdapter=this.uploadAdapterSrv.createProjectExperienceAdapter(),this.form=new r.gE({projectExperienceId:new r.MJ(void 0,[r.k0.required]),name:new r.MJ("",[r.k0.required]),projectRoles:new r.MJ([],[r.k0.required]),technologyTools:new r.MJ([],[r.k0.required]),description:new r.MJ("",[r.k0.required]),contributions:new r.MJ("",[r.k0.required])}),this._destroyRef=(0,e.WQX)(e.abz)}ngOnInit(){const n=this.codeSrv.getAdminCode(M.R.ProjectRole).pipe((0,d.p)(t=>this.apiSrv.ifSuccess(t)),(0,p.T)(({data:{codes:t}})=>t),(0,p.T)(t=>t.map(a=>({value:a.codeId,text:a.codeName}))),(0,_.M)(t=>this.projectRoleOptions.set(t))),s=this.codeSrv.getAdminCode(M.R.TechnologyTool).pipe((0,d.p)(t=>this.apiSrv.ifSuccess(t)),(0,p.T)(({data:{codes:t}})=>t),(0,p.T)(t=>t.map(a=>({value:a.codeId,text:a.codeName}))),(0,_.M)(t=>this.technologyToolOptions.set(t)));this.route.paramMap.pipe((0,_.M)(()=>this.isLoading.set(!0)),(0,d.p)(t=>!!t.get("id")),(0,p.T)(t=>t.get("id")),(0,E.n)(t=>this.projectExperienceSrv.getProjectExperienceById(parseInt(t))),(0,d.p)(t=>this.apiSrv.ifSuccess(t)),(0,p.T)(({data:t})=>t),(0,_.M)(t=>{const{projectExperienceId:a,name:h,projectRoles:v,technologyTools:f,description:i,contributions:F}=t;this.form.controls.projectExperienceId.setValue(a),this.form.controls.name.setValue(h);const N=v.map(({value:C})=>C);this.form.controls.projectRoles.setValue(N);const X=f.map(({value:C})=>C);this.form.controls.technologyTools.setValue(X),this.form.controls.description.setValue(i),this.form.controls.contributions.setValue(F)}),(0,E.n)(()=>(0,T.p)([n,s])),(0,P.pQ)(this._destroyRef)).subscribe(()=>this.isLoading.set(!1))}submit(){var n,s;if(this.form.markAllAsTouched(),this.form.invalid)return;const t=null!==(n=this.form.controls.projectRoles.value)&&void 0!==n?n:[],a=this.projectRoleOptions().filter(i=>t.includes(i.value)).map(i=>({text:i.text,value:i.value})),h=null!==(s=this.form.controls.technologyTools.value)&&void 0!==s?s:[],v=this.technologyToolOptions().filter(i=>h.includes(i.value)).map(i=>({text:i.text,value:i.value})),f={projectExperienceId:this.form.controls.projectExperienceId.value,name:this.form.controls.name.value,description:this.form.controls.description.value,contributions:this.form.controls.contributions.value,projectRoles:a,technologyTools:v,descriptionFiles:this.descriptionFiles(),contributionsFiles:this.contributionsFiles(),userId:this.userSrv.getUserId()};this.editIsLoading.set(!0),this.projectExperienceSrv.updateProjectExperience(f).pipe((0,d.p)(i=>this.apiSrv.ifSuccess(i,!0)),(0,E.n)(({returnMessage:i})=>this.swalSrv.alert({icon:j.J.Success,text:i})),(0,A.j)(()=>this.editIsLoading.set(!1)),(0,P.pQ)(this._destroyRef)).subscribe(()=>this.location.back())}descriptionUpload(n){this.descriptionFiles.update(s=>[...s,n])}contributionsUpload(n){this.contributionsFiles.update(s=>[...s,n])}}return(c=u).\u0275fac=function(n){return new(n||c)},c.\u0275cmp=e.VBU({type:c,selectors:[["app-project-experience-edit"]],standalone:!0,features:[e.aNF],decls:3,vars:2,consts:[["loading",""],[4,"ngIf","ngIfElse"],[3,"ngSubmit","formGroup"],[1,"my-5"],["labelName","\u5c08\u6848\u540d\u7a31","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u5c08\u6848\u540d\u7a31","formControlName","name",1,"w-full"],["labelName","\u5c08\u6848\u89d2\u8272","placeholder","\u8acb\u9078\u64c7\u5c08\u6848\u89d2\u8272","labelClass","text-lg my-2 text-center md:text-left","formControlName","projectRoles",1,"w-full",3,"options"],["labelName","\u5c08\u6848\u6280\u8853","placeholder","\u8acb\u9078\u64c7\u5c08\u6848\u6280\u8853","labelClass","text-lg my-2 text-center md:text-left","formControlName","technologyTools",1,"w-full",3,"options"],["labelName","\u5c08\u6848\u8ca2\u737b","labelClass","text-lg my-2 text-center md:text-left","formControlName","contributions",3,"upload","adapter"],["labelName","\u5c08\u6848\u63cf\u8ff0","labelClass","text-lg my-2 text-center md:text-left","placeholder","\u8acb\u8f38\u5165\u5c08\u6848\u63cf\u8ff0","formControlName","description",3,"upload","adapter"],[1,"flex","justify-end","items-center"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(n,s){if(1&n&&e.DNE(0,b,15,8,"ng-container",1)(1,S,1,0,"ng-template",null,0,e.C5r),2&n){const t=e.sdS(2);e.Y8G("ngIf",!s.isLoading())("ngIfElse",t)}},dependencies:[m.MD,m.bT,O.S,D.x,r.X1,r.qT,r.BC,r.cb,r.j4,r.JD,R.$,I.A]}),u})()}}]);